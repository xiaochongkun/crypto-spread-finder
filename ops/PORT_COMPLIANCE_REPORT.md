# Spread Finder - ç«¯å£åˆè§„æ€§ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2025-10-03
**æ“ä½œäººå‘˜**: Claude Code (DevOps Assistant)

---

## âœ… ä¿®å¤å®Œæˆ

### é—®é¢˜æè¿°
é¡¹ç›®åˆå§‹éƒ¨ç½²æ—¶ä½¿ç”¨äº†**ä¸åˆè§„çš„ç«¯å£**ï¼š
- å‰ç«¯: `0.0.0.0:3000` âŒ ï¼ˆç«¯å£ä¸åœ¨åˆ†é…èŒƒå›´ï¼Œä¸”æš´éœ²åœ¨å¤–ç½‘ï¼‰
- åç«¯: `127.0.0.1:3115` âœ… ï¼ˆç¬¦åˆè§„èŒƒï¼‰

**ç®¡ç†å‘˜åˆ†é…çš„ç«¯å£èŒƒå›´**: 3101-3200

---

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. å‰ç«¯ç«¯å£è°ƒæ•´
**å˜æ›´å‰**:
```bash
# ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œç«¯å£ 3000
0.0.0.0:3000
```

**å˜æ›´å**:
```bash
# ä»…ç›‘å¬æœ¬åœ°å›ç¯ï¼Œç«¯å£ 3117ï¼ˆåˆè§„èŒƒå›´ï¼‰
127.0.0.1:3117
```

**ä¿®æ”¹å‘½ä»¤**:
```bash
pm2 delete spread-finder-web
cd /home/kunkka/projects/spread-finder/frontend
pm2 start npm --name "spread-finder-web" -- start -- -p 3117 -H 127.0.0.1
pm2 save
```

### 2. é…ç½®æ–‡æ¡£æ›´æ–°
å·²æ›´æ–°ä»¥ä¸‹æ–‡æ¡£ï¼š
- `ops/CADDY_SETUP_REQUEST.md` - æ›´æ–°ç«¯å£å·ä¸º 3117
- `ops/CADDY_CONFIG.md` - ä¿æŒä¸€è‡´æ€§
- `ops/PORT_COMPLIANCE_REPORT.md` - æœ¬æ–‡æ¡£

---

## ğŸ“Š å½“å‰çŠ¶æ€

### ç«¯å£ç›‘å¬æƒ…å†µ
```bash
$ netstat -tuln | grep -E '3115|3117'
tcp  127.0.0.1:3115  ... LISTEN  âœ… åç«¯ï¼ˆåˆè§„ï¼‰
tcp  127.0.0.1:3117  ... LISTEN  âœ… å‰ç«¯ï¼ˆåˆè§„ï¼‰
```

### PM2 æœåŠ¡çŠ¶æ€
```bash
$ pm2 list | grep spread-finder
spread-finder-api  - online  - 127.0.0.1:3115
spread-finder-web  - online  - 127.0.0.1:3117
spread-finder-etl  - stopped - cron job (æ¯æ—¥ 16:05 UTC+8)
```

### åˆè§„æ€§éªŒè¯
| æ£€æŸ¥é¡¹ | è¦æ±‚ | å½“å‰çŠ¶æ€ | ç»“æœ |
|--------|------|---------|------|
| å‰ç«¯ç«¯å£èŒƒå›´ | 3101-3200 | 3117 | âœ… åˆè§„ |
| åç«¯ç«¯å£èŒƒå›´ | 3101-3200 | 3115 | âœ… åˆè§„ |
| å‰ç«¯ç›‘å¬åœ°å€ | 127.0.0.1 | 127.0.0.1 | âœ… åˆè§„ |
| åç«¯ç›‘å¬åœ°å€ | 127.0.0.1 | 127.0.0.1 | âœ… åˆè§„ |
| å¤–éƒ¨è®¿é—®æ–¹å¼ | ä»…é€šè¿‡ Caddy | éœ€é…ç½® Caddy | â³ å¾…å®Œæˆ |

---

## ğŸ§ª åŠŸèƒ½éªŒè¯

### æœ¬åœ°è®¿é—®æµ‹è¯•
```bash
# å‰ç«¯é¡µé¢
$ curl -I http://127.0.0.1:3117/spread-finder
HTTP/1.1 200 OK  âœ…

# API ä»£ç†ï¼ˆé€šè¿‡ Next.jsï¼‰
$ curl http://127.0.0.1:3117/spread-finder/api/health
{"status":"ok"}  âœ…

# åç«¯ç›´è¿
$ curl http://127.0.0.1:3115/api/health
{"status":"ok"}  âœ…
```

### å®‰å…¨æ€§éªŒè¯
```bash
# ç¡®è®¤æ— æ³•ä»å¤–éƒ¨ç›´æ¥è®¿é—®
$ curl http://<server-ip>:3117 --max-time 5
curl: (28) Connection timed out  âœ… é¢„æœŸè¡Œä¸º

$ curl http://<server-ip>:3115 --max-time 5
curl: (28) Connection timed out  âœ… é¢„æœŸè¡Œä¸º
```

---

## ğŸ“ Caddy é…ç½®éœ€æ±‚

### éœ€è¦æ·»åŠ çš„é…ç½®
ç”±äºç«¯å£å˜æ›´ï¼ŒCaddy é…ç½®ä¹Ÿéœ€è¦ç›¸åº”æ›´æ–°ï¼š

```caddy
# åœ¨ kunkka.spailab.com é…ç½®å—ä¸­æ·»åŠ 
handle /spread-finder* {
    reverse_proxy 127.0.0.1:3117  # ä» 3000 æ”¹ä¸º 3117
}
```

### å®Œæ•´é…ç½®ç¤ºä¾‹
```caddy
kunkka.spailab.com {
    # ç°æœ‰é…ç½®...

    # Spread Finder - æœŸæƒä»·å·®ç­›é€‰å™¨
    handle /spread-finder* {
        reverse_proxy 127.0.0.1:3117
    }

    # å…¶ä»–æœåŠ¡...

    handle {
        respond "Not Found" 404
    }
}
```

### é…ç½®æ­¥éª¤
1. è”ç³»ç®¡ç†å‘˜
2. æä¾›é…ç½®æ–‡æ¡£ï¼š`ops/CADDY_SETUP_REQUEST.md`
3. ç®¡ç†å‘˜æ·»åŠ é…ç½®
4. é‡è½½ Caddyï¼š`sudo systemctl reload caddy`
5. éªŒè¯å¤–éƒ¨è®¿é—®ï¼š`curl https://kunkka.spailab.com/spread-finder`

---

## ğŸ”’ å®‰å…¨æ”¹è¿›

### ä¿®å¤å‰çš„å®‰å…¨é£é™©
1. **ç«¯å£æš´éœ²**: å‰ç«¯ç›‘å¬ `0.0.0.0:3000`ï¼Œå¤–éƒ¨å¯ç›´æ¥è®¿é—®
2. **ç«¯å£è¶Šç•Œ**: 3000 ä¸åœ¨åˆ†é…èŒƒå›´ 3101-3200
3. **ç¼ºå°‘é˜²æŠ¤**: ç»•è¿‡ Caddy çš„ SSLã€è®¿é—®æ§åˆ¶ç­‰å®‰å…¨æœºåˆ¶

### ä¿®å¤åçš„å®‰å…¨çŠ¶æ€
1. âœ… æ‰€æœ‰æœåŠ¡ä»…ç›‘å¬ `127.0.0.1`
2. âœ… ç«¯å£åœ¨åˆ†é…èŒƒå›´å†… (3115, 3117)
3. âœ… å¤–éƒ¨è®¿é—®å¿…é¡»é€šè¿‡ Caddy åå‘ä»£ç†
4. âœ… è‡ªåŠ¨è·å¾— HTTPSã€è¯ä¹¦ã€è®¿é—®æ—¥å¿—ç­‰ä¿æŠ¤

---

## ğŸ“‹ ç»´æŠ¤å»ºè®®

### ç«¯å£ä½¿ç”¨è§„åˆ’
ä¸ºæœªæ¥æ‰©å±•é¢„ç•™ç«¯å£ï¼š

| ç”¨é€” | ç«¯å£ | çŠ¶æ€ |
|------|------|------|
| spread-finder-api | 3115 | ä½¿ç”¨ä¸­ âœ“ |
| spread-finder-web | 3117 | ä½¿ç”¨ä¸­ âœ“ |
| æ•°æ®åº“/Redisï¼ˆå¦‚éœ€ï¼‰ | 3116 | é¢„ç•™ |
| å…¶ä»–æ‰©å±• | 3118-3200 | å¯ç”¨ |

### æ–°æœåŠ¡éƒ¨ç½²æ¸…å•
å¯åŠ¨æ–°æœåŠ¡æ—¶ï¼Œç¡®ä¿ï¼š
- [ ] ç«¯å£åœ¨ 3101-3200 èŒƒå›´å†…
- [ ] ç›‘å¬åœ°å€ä¸º `127.0.0.1`ï¼ˆä¸æ˜¯ `0.0.0.0`ï¼‰
- [ ] éœ€è¦å¤–éƒ¨è®¿é—®æ—¶ï¼Œè”ç³»ç®¡ç†å‘˜é…ç½® Caddy
- [ ] ä½¿ç”¨ `netstat -tuln | grep <port>` éªŒè¯ç›‘å¬åœ°å€

### å®šæœŸæ£€æŸ¥è„šæœ¬
```bash
#!/bin/bash
# ç«¯å£åˆè§„æ€§æ£€æŸ¥è„šæœ¬

echo "=== Spread Finder ç«¯å£åˆè§„æ€§æ£€æŸ¥ ==="
echo ""

# æ£€æŸ¥ç«¯å£èŒƒå›´
echo "1. ç«¯å£èŒƒå›´æ£€æŸ¥ï¼ˆåº”åœ¨ 3101-3200ï¼‰:"
netstat -tuln | grep -E '311[5-7]' | grep LISTEN | while read line; do
    port=$(echo $line | awk '{print $4}' | cut -d: -f2)
    addr=$(echo $line | awk '{print $4}' | cut -d: -f1)
    if [ "$port" -ge 3101 ] && [ "$port" -le 3200 ]; then
        echo "  âœ“ ç«¯å£ $port (ç›‘å¬ $addr) - åˆè§„"
    else
        echo "  âœ— ç«¯å£ $port (ç›‘å¬ $addr) - ä¸åˆè§„ï¼"
    fi
done

echo ""
echo "2. ç›‘å¬åœ°å€æ£€æŸ¥ï¼ˆåº”ä¸º 127.0.0.1ï¼‰:"
if netstat -tuln | grep -E '311[5-7]' | grep -v '127.0.0.1' | grep LISTEN > /dev/null; then
    echo "  âœ— å‘ç°éæœ¬åœ°ç›‘å¬åœ°å€ï¼"
    netstat -tuln | grep -E '311[5-7]' | grep -v '127.0.0.1' | grep LISTEN
else
    echo "  âœ“ æ‰€æœ‰æœåŠ¡ä»…ç›‘å¬ 127.0.0.1"
fi

echo ""
echo "3. æœåŠ¡çŠ¶æ€:"
pm2 list | grep spread-finder
```

---

## ğŸ¯ åç»­ä»»åŠ¡

- [x] è°ƒæ•´å‰ç«¯ç«¯å£ä¸º 3117
- [x] é™åˆ¶ç›‘å¬åœ°å€ä¸º 127.0.0.1
- [x] éªŒè¯æœ¬åœ°æœåŠ¡åŠŸèƒ½
- [x] æ›´æ–°é…ç½®æ–‡æ¡£
- [x] ä¿å­˜ PM2 é…ç½®
- [ ] **è”ç³»ç®¡ç†å‘˜é…ç½® Caddy**ï¼ˆå”¯ä¸€å¾…åŠï¼‰
- [ ] éªŒè¯å¤–éƒ¨è®¿é—® `https://kunkka.spailab.com/spread-finder`

---

## ğŸ“ æ”¯æŒä¿¡æ¯

**é…ç½®æ–‡æ¡£ä½ç½®**:
- æœ¬æŠ¥å‘Š: `ops/PORT_COMPLIANCE_REPORT.md`
- Caddy é…ç½®è¯·æ±‚: `ops/CADDY_SETUP_REQUEST.md`
- è¯¦ç»†é…ç½®è¯´æ˜: `ops/CADDY_CONFIG.md`
- PM2 ç®¡ç†æŒ‡å—: `ops/PM2_ECOSYSTEM.md`

**éªŒè¯å‘½ä»¤**:
```bash
# å¿«é€Ÿå¥åº·æ£€æŸ¥
pm2 list | grep spread-finder
netstat -tuln | grep -E '3115|3117'
curl http://127.0.0.1:3117/spread-finder/api/health
```

**å›æ»šæ–¹æ¡ˆ**ï¼ˆå¦‚éœ€ï¼‰:
```bash
pm2 delete spread-finder-web
cd /home/kunkka/projects/spread-finder/frontend
pm2 start npm --name "spread-finder-web" -- start -- -p 3000
# æ³¨æ„ï¼šæ­¤æ“ä½œä¼šæ¢å¤åˆ°ä¸åˆè§„çŠ¶æ€ï¼Œä»…ç”¨äºç´§æ€¥æƒ…å†µ
```

---

**ä¿®å¤çŠ¶æ€**: âœ… **å®Œæˆ**ï¼ˆç­‰å¾… Caddy é…ç½®ä¸Šçº¿ï¼‰

**åˆè§„æ€§**: âœ… **100% ç¬¦åˆç®¡ç†å‘˜è¦æ±‚**

**ä¸‹ä¸€æ­¥**: è”ç³»ç®¡ç†å‘˜æ·»åŠ  Caddy é…ç½®ï¼Œå®Œæˆé¡¹ç›®ä¸Šçº¿
