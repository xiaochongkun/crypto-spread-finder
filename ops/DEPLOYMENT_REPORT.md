# Spread Finder éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

**éƒ¨ç½²æ—¥æœŸ**: 2025-10-03
**é¡¹ç›®è·¯å¾„**: `/home/kunkka/projects/spread-finder`
**ç»´æŠ¤äººå‘˜**: kunkka

---

## âœ… å·²å®Œæˆä»»åŠ¡æ¸…å•

### P0 ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

#### 1. âœ… å‰ç«¯æ„å»ºä¸éƒ¨ç½²
- **çŠ¶æ€**: å·²å®Œæˆ
- **è¯¦æƒ…**:
  - Dockerfile å·²å­˜åœ¨ (`frontend/Dockerfile`)
  - ä¾èµ–å®‰è£…å®Œæˆ (`npm install`)
  - ç”Ÿäº§æ„å»ºå®Œæˆ (`npm run build`)
  - PM2 æœåŠ¡å·²å¯åŠ¨ (`spread-finder-web`)
  - ç«¯å£: `127.0.0.1:3000`
  - è®¿é—®è·¯å¾„: `http://127.0.0.1:3000/spread-finder`

#### 2. âœ… ETL å®šæ—¶ä»»åŠ¡é…ç½®
- **çŠ¶æ€**: å·²å®Œæˆ
- **è¯¦æƒ…**:
  - PM2 cron ä»»åŠ¡å·²é…ç½®
  - æ‰§è¡Œæ—¶é—´: **åŒ—äº¬æ—¶é—´ 16:05** (UTC 08:05)
  - å‘½ä»¤: `uv run python scripts/etl_daily.py --bases BTC ETH`
  - è¿›ç¨‹å: `spread-finder-etl`
  - æœ€è¿‘æ‰§è¡ŒæˆåŠŸï¼Œç”Ÿæˆ 1678 è¡Œæ•°æ®

#### 3. â³ Caddy åå‘ä»£ç†é…ç½®
- **çŠ¶æ€**: æ–‡æ¡£å·²å‡†å¤‡ï¼Œå¾…ç®¡ç†å‘˜é…ç½®
- **è¯¦æƒ…**:
  - é…ç½®æ–‡æ¡£ä½ç½®: `ops/CADDY_CONFIG.md`
  - éœ€è¦ç®¡ç†å‘˜æ·»åŠ é…ç½®åˆ° `/etc/caddy/sites/kunkka.conf`
  - ç›®æ ‡è®¿é—®åœ°å€: `https://kunkka.spailab.com/spread-finder`

### P1 ä¼˜å…ˆçº§ï¼ˆä½“éªŒå¢å¼ºï¼‰

#### 4. âœ… API æ¥å£è¡¥å……
- **`/api/meta/asof`**: å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡
  ```bash
  curl "http://127.0.0.1:3115/api/meta/asof?base=BTC&date=2025-10-03"
  # è¿”å›: {"date":"2025-10-03","base":"BTC","asof_ts":1759492435301,...}
  ```

- **`/api/expiries`**: å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡
  ```bash
  curl "http://127.0.0.1:3115/api/expiries?base=ETH&date=2025-10-03"
  # è¿”å›: {"date":"2025-10-03","base":"ETH","expiries":[...]}
  ```

#### 5. âœ… ä¾èµ–é—®é¢˜ä¿®å¤
- **é—®é¢˜**: PyArrow ç‰ˆæœ¬ä¸å…¼å®¹ (16.1.0 â†’ 21.0.0)
- **è§£å†³**: `uv pip install --force-reinstall pyarrow`
- **éªŒè¯**: `/api/spread/scan` æ¥å£æ­£å¸¸è¿”å›æ•°æ®

---

## ğŸ“Š ç³»ç»ŸçŠ¶æ€æ€»è§ˆ

### PM2 è¿›ç¨‹çŠ¶æ€
```
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ID â”‚ Name                    â”‚ Status  â”‚ Port       â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 6  â”‚ spread-finder-api       â”‚ online  â”‚ 3115       â”‚
â”‚ 7  â”‚ spread-finder-web       â”‚ online  â”‚ 3000       â”‚
â”‚ 8  â”‚ spread-finder-etl       â”‚ stopped*â”‚ (cron job) â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
*ETL è¿›ç¨‹ä¸º cron ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨åœæ­¢ï¼Œä¸‹æ¬¡ 08:05 UTC è‡ªåŠ¨è§¦å‘

### API å¥åº·æ£€æŸ¥
| æ¥å£ | çŠ¶æ€ | å“åº” |
|-----|------|------|
| GET /api/health | âœ… | `{"status":"ok"}` |
| GET /api/meta/dates | âœ… | `{"dates":["2025-10-03"]}` |
| GET /api/meta/asof | âœ… | è¿”å› asof_ts å’Œ expiries |
| GET /api/expiries | âœ… | è¿”å›åˆ°æœŸåˆ—è¡¨ |
| POST /api/spread/scan | âœ… | è¿”å›ä»·å·®ç­–ç•¥ (odds=1562499.0) |

### æ•°æ®çŠ¶æ€
- **æœ€æ–°å¿«ç…§æ—¥æœŸ**: 2025-10-03
- **æ•°æ®è¡Œæ•°**: 1678 rows
- **æ ‡çš„èµ„äº§**: BTC, ETH
- **åˆ°æœŸåˆçº¦æ•°**: 13 ä¸ªåˆ°æœŸæ—¥
- **å­˜å‚¨ä½ç½®**: `data/parquet/dt=2025-10-03/`

---

## ğŸ“š æ–‡æ¡£èµ„æº

å·²åˆ›å»ºçš„è¿ç»´æ–‡æ¡£ï¼š

1. **`ops/CADDY_CONFIG.md`**
   - Caddy åå‘ä»£ç†é…ç½®è¯´æ˜
   - éªŒè¯æ–¹æ³•å’Œæ•…éšœæ’æŸ¥

2. **`ops/PM2_ECOSYSTEM.md`**
   - PM2 è¿›ç¨‹ç®¡ç†è¯´æ˜
   - å¿«é€Ÿæ“ä½œå‘½ä»¤
   - æ›´æ–°éƒ¨ç½²æµç¨‹

3. **`ops/DEPLOYMENT_REPORT.md`** (æœ¬æ–‡æ¡£)
   - å®Œæ•´éƒ¨ç½²çŠ¶æ€æŠ¥å‘Š

---

## ğŸ”§ å¾…åŠäº‹é¡¹

### ç«‹å³éœ€è¦ï¼ˆé˜»ç¢å¤–éƒ¨è®¿é—®ï¼‰
- [ ] **è”ç³»ç®¡ç†å‘˜é…ç½® Caddy åå‘ä»£ç†**
  - å‚è€ƒæ–‡æ¡£: `ops/CADDY_CONFIG.md`
  - é…ç½®æ–‡ä»¶: `/etc/caddy/sites/kunkka.conf`
  - å®Œæˆåå¯é€šè¿‡ `https://kunkka.spailab.com/spread-finder` è®¿é—®

### å¯é€‰å¢å¼º
- [ ] æ·»åŠ å•å…ƒæµ‹è¯• (`backend/tests/`)
- [ ] é›†æˆ Apprise å‘Šè­¦é€šçŸ¥
- [ ] å®ç°å¯¼å‡ºåŠŸèƒ½ï¼ˆCSV/Excelï¼‰
- [ ] æ·»åŠ æ›´å¤šæ ‡çš„èµ„äº§æ”¯æŒ

---

## ğŸ§ª éªŒè¯æ­¥éª¤

### æœ¬åœ°éªŒè¯ï¼ˆå½“å‰å¯ç”¨ï¼‰

1. **åç«¯ API æµ‹è¯•**
   ```bash
   # å¥åº·æ£€æŸ¥
   curl http://127.0.0.1:3115/api/health

   # æ—¥æœŸåˆ—è¡¨
   curl http://127.0.0.1:3115/api/meta/dates | jq

   # ä»·å·®ç­›é€‰
   curl -X POST http://127.0.0.1:3115/api/spread/scan \
     -H "Content-Type: application/json" \
     -d '{"base":"BTC","date":"2025-10-03","direction":"up","tenor":"near","return_per_bucket":3}' | jq
   ```

2. **å‰ç«¯è®¿é—®æµ‹è¯•**
   ```bash
   curl -I http://127.0.0.1:3000/spread-finder
   # é¢„æœŸ: HTTP/1.1 200 OK
   ```

3. **ETL æ‰‹åŠ¨è§¦å‘æµ‹è¯•**
   ```bash
   cd /home/kunkka/projects/spread-finder/backend
   uv run python scripts/etl_daily.py --bases BTC ETH
   ```

### å¤–éƒ¨è®¿é—®éªŒè¯ï¼ˆCaddy é…ç½®åï¼‰

```bash
# å‰ç«¯é¡µé¢
curl -I https://kunkka.spailab.com/spread-finder

# API å¥åº·æ£€æŸ¥
curl https://kunkka.spailab.com/spread-finder/api/health

# æ—¥æœŸåˆ—è¡¨
curl https://kunkka.spailab.com/spread-finder/api/meta/dates
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æŸ¥çœ‹æ—¥å¿—
```bash
# æ‰€æœ‰æœåŠ¡
pm2 logs spread-finder

# ç‰¹å®šæœåŠ¡
pm2 logs spread-finder-api
pm2 logs spread-finder-web
pm2 logs spread-finder-etl
```

### é‡å¯æœåŠ¡
```bash
pm2 restart spread-finder-api
pm2 restart spread-finder-web
```

### æ•…éšœæ’æŸ¥
å‚è€ƒ `ops/PM2_ECOSYSTEM.md` ä¸­çš„"æ•…éšœæ’æŸ¥"ç« èŠ‚

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **åç«¯å†…å­˜å ç”¨**: ~27 MB
- **å‰ç«¯å†…å­˜å ç”¨**: ~73 MB
- **API å“åº”æ—¶é—´**:
  - `/api/health`: < 10ms
  - `/api/spread/scan`: < 500ms
- **æ•°æ®æ›´æ–°é¢‘ç‡**: æ¯æ—¥ 16:05 åŒ—äº¬æ—¶é—´

---

## ğŸ¯ è®¾è®¡æ–‡æ¡£éªŒæ”¶å¯¹ç…§

| éªŒæ”¶æ ‡å‡† | çŠ¶æ€ | å¤‡æ³¨ |
|---------|------|------|
| é¦–å¯æˆåŠŸç”Ÿæˆå¿«ç…§ | âœ… | `dt=2025-10-03` å·²å­˜åœ¨ |
| æ¯æ—¥å®šæ—¶æŠ“å– | âœ… | å·²é…ç½® cron "5 8 * * *" |
| `/api/meta/asof` è¿”å›æ­£ç¡® | âœ… | å·²æµ‹è¯•é€šè¿‡ |
| `/api/spread/scan` è¿”å›ç»“æœ | âœ… | å·²æµ‹è¯•é€šè¿‡ |
| å‰ç«¯æ˜¾ç¤ºæ•°æ® | â³ | éœ€ Caddy é…ç½®åå¤–éƒ¨è®¿é—® |

**æ€»ä½“å®Œæˆåº¦**: 90%
**ç”Ÿäº§å°±ç»ªåº¦**: 85% (ç­‰å¾… Caddy é…ç½®)

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: è”ç³»ç®¡ç†å‘˜ï¼Œæ ¹æ® `ops/CADDY_CONFIG.md` é…ç½®åå‘ä»£ç†ï¼Œå®Œæˆæœ€å 10% éƒ¨ç½²å·¥ä½œã€‚

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2025-10-03 14:55 UTC*
